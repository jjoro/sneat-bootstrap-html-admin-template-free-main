<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ApexChart Instance Inspector</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body class="p-8 flex flex-col items-center min-h-screen text-slate-800">

  <div class="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-2 gap-8">
    
    <!-- ì™¼ìª½: ì°¨íŠ¸ ìƒì„± ë° ì œì–´ ì˜ì—­ -->
    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <span>ğŸ“Š</span> ì°¨íŠ¸ ìƒì„± (Chart Generator)
      </h2>
      
      <!-- ì°¨íŠ¸ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
      <div class="grid grid-cols-4 gap-2 mb-6" id="chart-controls">
        <button data-type="bar" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm transition">Bar</button>
        <button data-type="line" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-3 rounded text-sm transition">Line</button>
        <button data-type="area" class="bg-emerald-500 hover:bg-emerald-600 text-white py-2 px-3 rounded text-sm transition">Area</button>
        <button data-type="donut" class="bg-orange-500 hover:bg-orange-600 text-white py-2 px-3 rounded text-sm transition">Donut</button>
      </div>

      <div class="text-xs text-gray-500 mb-2">
        í˜„ì¬ í• ë‹¹ëœ ID: <span id="current-chart-id" class="font-mono font-bold text-blue-600">ì—†ìŒ</span>
      </div>
      
      <!-- ì°¨íŠ¸ ë Œë”ë§ ì˜ì—­ -->
      <div id="chart-container" class="min-h-[350px]"></div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì°¨íŠ¸ ì¡°íšŒ ì˜ì—­ (Inspector) -->
    <div class="bg-slate-900 text-slate-200 p-6 rounded-xl shadow-lg flex flex-col">
      <h2 class="text-xl font-bold mb-4 text-slate-100 flex items-center gap-2">
        <span>ğŸ”</span> ì¸ìŠ¤í„´ìŠ¤ ì¡°íšŒ (Inspector)
      </h2>
      
      <div class="flex gap-2 mb-6">
        <input type="text" id="input-chart-id" placeholder="ì¡°íšŒí•  Chart ID ì…ë ¥ (ì˜ˆ: my-chart-bar)" 
          class="flex-1 bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500 text-white transition">
        <button id="btn-inspect" 
          class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded text-sm font-medium transition">
          ì¡°íšŒí•˜ê¸°
        </button>
      </div>

      <!-- ê²°ê³¼ ì¶œë ¥ ì˜ì—­ -->
      <div class="flex-1 overflow-auto bg-slate-800 rounded-lg p-4 border border-slate-700 font-mono text-xs leading-relaxed space-y-4">
        
        <div>
          <h3 class="text-green-400 font-bold border-b border-slate-600 pb-1 mb-2">1. Series (ë°ì´í„°)</h3>
          <div id="res-series" class="text-slate-300">ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>

        <div>
          <h3 class="text-yellow-400 font-bold border-b border-slate-600 pb-1 mb-2">2. Categories (ì¶• ë¼ë²¨)</h3>
          <div id="res-categories" class="text-slate-300">ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>

        <div>
          <h3 class="text-blue-400 font-bold border-b border-slate-600 pb-1 mb-2">3. Options (ì„¤ì • ìš”ì•½)</h3>
          <div id="res-options" class="text-slate-300">ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>

      </div>
    </div>
  </div>

  <script>
    /**
     * ==========================================
     * 1. CORE LOGIC: ì°¨íŠ¸ ë°ì´í„° ì¶”ì¶œ í•¨ìˆ˜
     * ==========================================
     * ApexCharts ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì•ˆì „í•˜ê²Œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ìˆœìˆ˜ í•¨ìˆ˜í˜• ë¡œì§
     */
    const ChartInspector = (() => {
      
      // ë‚´ë¶€ í—¬í¼: ì•ˆì „í•œ ê°ì²´ ì ‘ê·¼ (Optional Chaining ëŒ€ì²´)
      const get = (obj, path, defaultValue = undefined) => {
        return path.split('.').reduce((acc, part) => acc && acc[part], obj) || defaultValue;
      };

      // í•µì‹¬ í•¨ìˆ˜: IDë¡œ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ì•„ ë°ì´í„° ë°˜í™˜
      const getChartStateById = (chartId) => {
        // 1. ApexCharts ì „ì—­ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ê²€ìƒ‰
        const chartInstance = ApexCharts.getChartByID(chartId);

        if (!chartInstance) {
          return { error: `IDê°€ '${chartId}'ì¸ ì°¨íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.` };
        }

        // 2. ë‚´ë¶€ ì„¤ì • ê°ì²´(config) ì ‘ê·¼
        // wëŠ” ApexChartsì˜ ë‚´ë¶€ wireframe ê°ì²´ì…ë‹ˆë‹¤.
        const config = chartInstance.w.config;

        // 3. Categories ì¶”ì¶œ (ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ìœ„ì¹˜ê°€ ë‹¤ë¦„)
        // ì¼ë°˜ ì°¨íŠ¸ëŠ” xaxis.categories, ë„ë„›/íŒŒì´ëŠ” labelsì— ì €ì¥ë¨
        const categories = config.xaxis?.categories?.length > 0 
          ? config.xaxis.categories 
          : (config.labels || []);

        // 4. ê²°ê³¼ ë°˜í™˜
        return {
          id: config.chart.id,
          series: config.series,      // ì‹¤ì œ ë°ì´í„° ì‹œë¦¬ì¦ˆ
          categories: categories,     // ì •ê·œí™”ëœ ì¹´í…Œê³ ë¦¬
          options: config,            // ì „ì²´ ì˜µì…˜ ì›ë³¸
          type: config.chart.type     // í¸ì˜ë¥¼ ìœ„í•´ íƒ€ì… ì¶”ê°€
        };
      };

      return { inspect: getChartStateById };
    })();


    /**
     * ==========================================
     * 2. APP LOGIC: ì°¨íŠ¸ ìƒì„± ë° ê´€ë¦¬
     * ==========================================
     */
    
    // ì°¨íŠ¸ ìƒì„±ì„ ìœ„í•œ ë”ë¯¸ ë°ì´í„° íŒ©í† ë¦¬
    const createChartConfig = (type) => {
      const uniqueId = `chart-${type}-${Date.now().toString().slice(-4)}`;
      
      const common = {
        chart: { 
          id: uniqueId, // ì¤‘ìš”: ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•  IDë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •
          height: 350, 
          type: type,
          toolbar: { show: false }
        }
      };

      if (type === 'donut') {
        return {
          ...common,
          series: [44, 55, 41, 17, 15],
          labels: ['Apple', 'Mango', 'Orange', 'Watermelon', 'Grape']
        };
      } else {
        return {
          ...common,
          series: [{ name: "Sample Data", data: Array.from({length: 9}, () => Math.floor(Math.random() * 100)) }],
          xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'] }
        };
      }
    };

    // ì°¨íŠ¸ ë Œë”ëŸ¬ (í´ë¡œì €)
    const renderChart = (() => {
      let currentChart = null;

      return (type) => {
        const container = document.querySelector("#chart-container");
        if (currentChart) currentChart.destroy();

        const options = createChartConfig(type);
        currentChart = new ApexCharts(container, options);
        currentChart.render();

        // UI ì—…ë°ì´íŠ¸: í˜„ì¬ ìƒì„±ëœ ID í‘œì‹œ
        document.getElementById('current-chart-id').textContent = options.chart.id;
        // ì…ë ¥ì°½ì— ìë™ìœ¼ë¡œ ID ì±„ì›Œì£¼ê¸° (í¸ì˜ì„±)
        document.getElementById('input-chart-id').value = options.chart.id;
        
        return options.chart.id;
      };
    })();


    /**
     * ==========================================
     * 3. UI HANDLERS: ì´ë²¤íŠ¸ ë°”ì¸ë”©
     * ==========================================
     */
    document.addEventListener('DOMContentLoaded', () => {
      
      // 1. ì°¨íŠ¸ ìƒì„± ë²„íŠ¼ë“¤
      document.querySelectorAll('#chart-controls button').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const type = e.target.dataset.type;
          renderChart(type);
          
          // ì°¨íŠ¸ê°€ ìƒˆë¡œ ìƒì„±ë˜ë©´ ìë™ìœ¼ë¡œ ì¡°íšŒ ì‹¤í–‰ (UX í–¥ìƒ)
          setTimeout(() => document.getElementById('btn-inspect').click(), 100);
        });
      });

      // 2. ì¡°íšŒ(Inspect) ë²„íŠ¼
      document.getElementById('btn-inspect').addEventListener('click', () => {
        const inputId = document.getElementById('input-chart-id').value.trim();
        
        if (!inputId) {
          alert('ì°¨íŠ¸ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        // í•µì‹¬ ê¸°ëŠ¥ í˜¸ì¶œ
        const result = ChartInspector.inspect(inputId);

        // ê²°ê³¼ ë Œë”ë§
        const elSeries = document.getElementById('res-series');
        const elCategories = document.getElementById('res-categories');
        const elOptions = document.getElementById('res-options');

        if (result.error) {
          elSeries.innerHTML = `<span class="text-red-400">Error: ${result.error}</span>`;
          elCategories.textContent = '';
          elOptions.textContent = '';
        } else {
          elSeries.textContent = JSON.stringify(result.series, null, 2);
          elCategories.textContent = JSON.stringify(result.categories, null, 2);
          
          // OptionsëŠ” ë„ˆë¬´ ê¸°ë‹ˆê¹Œ í•µì‹¬ë§Œ ì¶”ë ¤ì„œ ë³´ì—¬ì£¼ê±°ë‚˜ ì „ì²´ ë³´ì—¬ì£¼ê¸°
          // ì—¬ê¸°ì„œëŠ” ì£¼ìš” ì†ì„±ë§Œ ìš”ì•½
          const summaryOptions = {
            chart: result.options.chart,
            colors: result.options.colors,
            stroke: result.options.stroke,
            // ...í•„ìš”í•œ ë§Œí¼ ì¶”ê°€
          };
          elOptions.textContent = JSON.stringify(summaryOptions, null, 2);
        }
      });

      // ì´ˆê¸° ì‹¤í–‰
      renderChart('bar');
    });

  </script>
</body>
</html>


